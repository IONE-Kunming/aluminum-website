# Firebase Hosting Deployment Guide

## Overview
This guide explains how to properly deploy the IONE aluminum website to Firebase Hosting.

## Problem Statement
If you deployed to Firebase and the website is not loading any pages, it's likely because the project was deployed **without building first**. Firebase Hosting serves files from the `dist/` directory, which is generated by the build process.

## Prerequisites
- Node.js 18+ installed
- Firebase project created (Project ID: `gen-lang-client-0988357303`)
- Firebase CLI installed globally

## Complete Deployment Process

### Step 1: Install Dependencies
```bash
cd /path/to/aluminum-website
npm install
```

This installs Vite and other build tools needed to generate the production files.

### Step 2: Build the Project
```bash
npm run build
```

This command:
- Runs Vite to bundle and optimize the code
- Generates the `dist/` folder with production-ready files
- Minifies JavaScript and CSS
- Creates hashed filenames for cache busting
- Outputs approximately 59KB total (11KB gzipped)

**Output structure:**
```
dist/
├── index.html              # Main HTML file with bundled script refs
├── assets/                 # Optimized JS and CSS files
│   ├── main-[hash].js     # Main application bundle
│   ├── main-[hash].css    # Compiled styles
│   └── [other chunks]     # Code-split modules
├── css/                    # Static CSS files
├── js/                     # Static JS files (config, etc.)
├── pages/                  # Page-specific files
├── logo.svg
├── vite.svg
├── .nojekyll              # For GitHub Pages compatibility
└── 404.html               # SPA fallback page
```

### Step 3: Verify Build Output
```bash
ls -la dist/
```

You should see:
- `index.html` - The main HTML file
- `assets/` folder with bundled JS and CSS files
- All static files from `public/` directory

### Step 4: Install Firebase CLI (if not already installed)
```bash
npm install -g firebase-tools
```

### Step 5: Login to Firebase
```bash
firebase login
```

This will open a browser window for authentication.

### Step 6: Initialize Firebase Hosting (First Time Only)
```bash
firebase init hosting
```

**Answer the prompts as follows:**
- **Select a default Firebase project**: Choose `gen-lang-client-0988357303`
- **What do you want to use as your public directory?**: `dist`
- **Configure as a single-page app (rewrite all urls to /index.html)?**: `Yes`
- **Set up automatic builds and deploys with GitHub?**: `No` (optional)
- **File dist/index.html already exists. Overwrite?**: `No`

This creates/updates:
- `firebase.json` - Firebase configuration
- `.firebaserc` - Project aliases

### Step 7: Deploy to Firebase Hosting
```bash
firebase deploy --only hosting
```

Or deploy everything (hosting + rules):
```bash
firebase deploy
```

**Expected output:**
```
✔ Deploy complete!

Project Console: https://console.firebase.google.com/project/gen-lang-client-0988357303/overview
Hosting URL: https://gen-lang-client-0988357303.web.app
```

### Step 8: Verify Deployment
1. Open the hosting URL in your browser
2. Check the browser console for errors (F12 > Console)
3. Verify that all pages load correctly
4. Test authentication and key features

## Common Issues and Solutions

### Issue 1: "Cannot GET /" or Blank Page
**Cause**: The `dist/` folder doesn't exist or is empty.

**Solution**:
```bash
npm run build
firebase deploy --only hosting
```

### Issue 2: 404 Errors for Assets
**Cause**: Assets not properly bundled or wrong base path.

**Solution**:
1. Verify `vite.config.js` has `base: '/'` (not `/aluminum-website/`)
2. Rebuild: `npm run build`
3. Redeploy: `firebase deploy --only hosting`

### Issue 3: "vite: not found" Error
**Cause**: Dependencies not installed.

**Solution**:
```bash
npm install
npm run build
```

### Issue 4: Firebase Config Errors
**Cause**: Wrong Firebase project configuration in `public/js/config.js`.

**Solution**:
Verify the config matches your Firebase project:
```javascript
const firebaseConfig = {
  apiKey: "AIzaSyA2soyxD1Bqe40CmgMDIGnPKmTp6QW2vmM",
  authDomain: "gen-lang-client-0988357303.firebaseapp.com",
  projectId: "gen-lang-client-0988357303",
  storageBucket: "gen-lang-client-0988357303.firebasestorage.app",
  messagingSenderId: "248469969544",
  appId: "1:248469969544:web:460684f506faec8b9b1d3d",
  measurementId: "G-J7L65NCMB5"
};
```

### Issue 5: Security Rules Not Working
**Cause**: Firestore and Storage rules not deployed.

**Solution**:
```bash
# Deploy Firestore rules
firebase deploy --only firestore:rules

# Deploy Storage rules
firebase deploy --only storage

# Or deploy all rules at once
firebase deploy --only firestore:rules,storage
```

## Deployment Checklist

Before deploying, ensure:
- [ ] `npm install` has been run
- [ ] `npm run build` completes successfully
- [ ] `dist/` folder exists and contains files
- [ ] `dist/index.html` exists and references bundled assets
- [ ] Firebase CLI is installed and you're logged in
- [ ] `firebase.json` has `"public": "dist"` setting
- [ ] Security rules are deployed

After deploying, verify:
- [ ] Website loads at the hosting URL
- [ ] No 404 errors in browser console
- [ ] All pages are accessible
- [ ] Authentication works
- [ ] Images and assets load correctly

## Quick Redeploy Process

For subsequent deployments after code changes:

```bash
# 1. Build the updated code
npm run build

# 2. Deploy to Firebase
firebase deploy --only hosting
```

That's it! The build process takes ~1 second, and deployment takes ~10-30 seconds.

## Development vs Production

### Development Mode
```bash
npm run dev
# Runs on http://localhost:5173/
# Hot module reloading enabled
# Source maps available
```

### Production Mode
```bash
npm run build      # Build for production
npm run preview    # Preview production build locally on http://localhost:4173/
```

### Testing Production Build Locally
Before deploying, test the production build:
```bash
npm run build
npm run preview
# Open http://localhost:4173/ in your browser
```

## Performance Optimization

The build process automatically:
- ✅ Minifies JavaScript and CSS
- ✅ Removes console.logs
- ✅ Creates code-split bundles for faster loading
- ✅ Generates hashed filenames for cache busting
- ✅ Compresses assets with gzip
- ✅ Optimizes images and static files

**Result**: 59KB total bundle (11KB gzipped) - 90% smaller than React version!

## Custom Domain Setup

To use a custom domain (e.g., `ione.live`):

1. **In Firebase Console**:
   - Go to Hosting > Add custom domain
   - Follow the DNS configuration instructions

2. **Update DNS records** (with your domain provider):
   - Add A record pointing to Firebase IPs
   - Or add CNAME record pointing to Firebase hosting

3. **Wait for SSL certificate** (automatic, takes ~24 hours)

4. **Access your site** at `https://yourdomain.com`

## CI/CD with GitHub Actions

For automated deployments, create `.github/workflows/firebase-deploy.yml`:

```yaml
name: Deploy to Firebase Hosting

on:
  push:
    branches:
      - main

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm install
      
      - name: Build
        run: npm run build
      
      - name: Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
          channelId: live
          projectId: gen-lang-client-0988357303
```

## Troubleshooting

### Enable Debug Logging
```bash
firebase --debug deploy --only hosting
```

### View Hosting Releases
```bash
firebase hosting:channel:list
```

### Rollback to Previous Version
In Firebase Console:
1. Go to Hosting > Dashboard
2. Click on the release history
3. Select a previous version
4. Click "Rollback"

## Support

For issues:
1. Check the browser console for errors (F12 > Console)
2. Verify `dist/` folder exists and has recent files
3. Check Firebase Console > Hosting for deployment status
4. Review Firebase Console > Authentication/Firestore/Storage for backend issues

## Summary

**Key Points to Remember:**
1. ⚠️ **Always run `npm run build` before deploying**
2. Firebase serves from `dist/` folder, not `public/` folder
3. The build process is required - it creates the production files
4. Test locally with `npm run preview` before deploying
5. Deploy with `firebase deploy --only hosting`

Following these steps will ensure your website loads correctly on Firebase Hosting!
